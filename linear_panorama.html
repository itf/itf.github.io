<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2020-07-27 Mon 20:59 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Linear Panorama</title>
<meta name="generator" content="Org mode">
<meta name="author" content="ivanaf">
<link rel="stylesheet" type="text/css" href="css/org.css"/>
<link rel="icon" href="ico/favicon.ico" type="image/x- icon">
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<div class="head">
<div class="title">
<p>
<a href="index.html">Ivanaf</a>
</p>

</div>

<menu>
<ul class="org-ul">
<li><a href="index.html">Home</a></li>
<li><a href="about.html">About</a></li>
<li><a href="resume.html">Resume</a></li>
<li><a href="portfolio.html">Portfolio</a></li>
<li><a href="contact.html">Contact</a></li>
<li><a href="tags.html">Tags</a></li>
<li><a href="projects_ideas.html">Messy Ideas</a></li>
</ul>
</menu>

</div>

<p>
 </p><h1>
Linear Panorama
 </h1><p>
</p>

<p>
<span class=page-date> <small>
2015-12-13, updated 2020-07-26 &#x2014; <a href="./tags.html#projects">#projects</a> <a href="./tags.html#photography">#photography</a> <a href="./tags.html#tech">#tech</a>  &nbsp  <a href="led_panel.html">⇦Led Panel</a> &#x2013; <a href="hello_world.html">Hello world!⇨</a> 
</small> </span> 
</p>
<nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#summary-photographing-linear-panoramas-of-murals-in-a-place-with-poor-light-conditions-and-short-distance-to-the-wall.">1. Summary:</a></li>
<li><a href="#intro">2. Intro</a></li>
<li><a href="#hardware">3. Hardware</a></li>
<li><a href="#software">4. Software</a></li>
<li><a href="#work-flow">5. Work Flow</a></li>
</ul>
</div>
</nav>

<div id="outline-container-summary" class="outline-2">
<h2 id="summary-photographing-linear-panoramas-of-murals-in-a-place-with-poor-light-conditions-and-short-distance-to-the-wall."><a id="summary"></a><span class="section-number-2">1</span> Summary:</h2>
<div class="outline-text-2" id="text-summary-photographing-linear-panoramas-of-murals-in-a-place-with-poor-light-conditions-and-short-distance-to-the-wall.">
<p>
Photographing linear panoramas of murals, in a place with poor light conditions, and short distance to the wall.
</p>
</div>
</div>
<div id="outline-container-intro" class="outline-2">
<h2 id="intro"><a id="intro"></a><span class="section-number-2">2</span> Intro</h2>
<div class="outline-text-2" id="text-intro">
<p>
Photographing the murals in my dorm is a really challenging task. The
distance between the walls in the corridor is between 1.5m to 1.7m and
the height of the murals is approximately 2m.
</p>

<p>
Besides this, I don't have any special device to illuminate the walls,
besides a simple octopus floor lamp with yellowish incandescent lights.
</p>

<p>
Given these constrains I photographed the murals, and made the following
linear panoramas (click for full size)
<a href="http://slugwiki.mit.edu/images/5/5e/BS.jpg"><img src="http://slugwiki.mit.edu/images/thumb/5/5e/BS.jpg/798px-BS.jpg" alt="798px-BS.jpg"></a>
</p>


<figure>
<a href="http://slugwiki.mit.edu/images/5/5b/BC.jpg"><img src="http://slugwiki.mit.edu/images/thumb/5/5b/BC.jpg/800px-BC.jpg" alt="800px-BC.jpg"></a>

</figure>
</div>
</div>

<div id="outline-container-hardware" class="outline-2">
<h2 id="hardware"><a id="hardware"></a><span class="section-number-2">3</span> Hardware</h2>
<div class="outline-text-2" id="text-hardware">
<ul class="org-ul">
<li>Canon T2i with <a href="http://www.magiclantern.fm/"><i>Magic Lantern</i></a>
installed</li>
<li>Opteka 6.5mm (Also known as Samyang 8mm, it is the same lens sold by
a different company)</li>
<li>Octopus floor lamp (any floor lamp would work)</li>
<li>Tripod (set to around 1m)</li>
</ul>
</div>
</div>

<div id="outline-container-software" class="outline-2">
<h2 id="software"><a id="software"></a><span class="section-number-2">4</span> Software</h2>
<div class="outline-text-2" id="text-software">
<ul class="org-ul">
<li>Enfuse</li>
<li>Macrofusion</li>
<li>Hugin</li>
</ul>
</div>
</div>

<div id="outline-container-work_flow" class="outline-2">
<h2 id="work-flow"><a id="work_flow"></a><span class="section-number-2">5</span> Work Flow</h2>
<div class="outline-text-2" id="text-work-flow">
</div>

<div id="outline-container-calibrate_the_lens" class="outline-3">
<h3 id="calibrate-the-lens."><a id="calibrate_the_lens"></a><span class="section-number-3">5.1</span> Calibrate the Lens.</h3>
<div class="outline-text-3" id="text-calibrate-the-lens.">
<p>
If your lens are not calibrated, this should be the first step, if not,
skip this session. At first, take a picture of a mural in a way that
there are many clear straight lines in the image. Load the image in
Hugin. The follow the
<a href="http://hugin.sourceforge.net/tutorials/calibration/en.shtml"><i>instruction on Hugin to calibrate your lens</i></a>. Instead of using a diagonal line,
which might be hard to find, you can use multiple horizontal and
vertical lines. However, do not choose horizontal line on the options.
</p>

<p>
If you are using a non standard lens, such as the Samyang 8mm, it is
sometimes better to calibrate the lens for the approximate distance that
you are gonna take the pictures from.
</p>
</div>
</div>

<div id="outline-container-taking_the_pictures" class="outline-3">
<h3 id="taking-the-pictures."><a id="taking_the_pictures"></a><span class="section-number-3">5.2</span> Taking the pictures.</h3>
<div class="outline-text-3" id="text-taking-the-pictures.">
<p>
Set your tripod to be about half of the right of the wall your are
photographing (in case it is very near you). If it is farther, or you
are not using fish-eye lens this won't affect you much.
</p>

<p>
Set your camera to fully manual mode, set the ISO to the lowest setting
(in order to minimize noise), set the focus to manual mode, and also set
the white balance to manual mode. It doesn't matter what setting you
choose for the white balance.
</p>

<p>
Take multiple pictures, moving the position of the lights between each
picture, but do not move the camera. This will assure you that you have
the whole scene well illuminated. Besides this, by having your light
coming from multiple directions, the end result will have even light,
which considerably improves the quality of the image (It makes it look
like a scanner)
</p>

<p>
In order to not move the camera, you should use a shutter cable, or
using the <a href="http://wiki.magiclantern.fm/userguide"><i>LCDsensor Remote</i></a>
shoot on shooting preferences of Magic Lantern, if you use a canon dlsr.
</p>

<figure>
<img src="./jpg/mural_1.jpg" alt="mural_1.jpg">

</figure>

<figure>
<img src="./jpg/mural_2.jpg" alt="mural_2.jpg">

</figure>


<figure>
<img src="./jpg/mural_3.jpg" alt="mural_3.jpg">

</figure>
</div>
</div>


<div id="outline-container-fusing_the_images" class="outline-3">
<h3 id="fusing_the_images"><span class="section-number-3">5.3</span> Fusing the images</h3>
<div class="outline-text-3" id="text-5-3">
<p>
:CUSTOM_ID: fusing-the-images
</p>

<p>
To fuse the images, you should use
<a href="http://wiki.panotools.org/Enfuse">Enfuse</a>. Enfuse is a command line
tool for exposure fusing (it can also )
</p>

<p>
In order to better enfuse the pictures I recommend
<a href="http://sourceforge.net/projects/macrofusion/"><i>Macrofusion</i></a>.
Macrofusion is a fast, simple and responsive GUI for Enfuse. Macrofusion
makes it easy to choose the weights of exposure, contrast and saturation
when fusing the images.
</p>


<figure>
<img src="./jpg/mural_enfused.jpg" alt="mural_enfused.jpg">

<figcaption><span class="figure-number">Figure 5: </span>Mural enfused </figcaption>
</figure>
</div>
</div>


<div id="outline-container-straightening_the_images" class="outline-3">
<h3 id="straightening-the-images."><a id="straightening_the_images"></a><span class="section-number-3">5.4</span> Straightening the images.</h3>
<div class="outline-text-3" id="text-straightening-the-images.">
<p>
Open the image in Hugin, and load the lens configuration for your lens.
</p>

<p>
Choose a rectilinear projection in Hugin's fast preview window.
</p>

<figure>
<img src="./png/hugin_options.png" alt="hugin_options.png">

</figure>

<p>
This should have straightened up the image. But there should still be
perspective problems. Set the horizon and vertical lines in the control
points tab and optimize the lens parameters. A full tutorial can be seen
on
<a href="http://hugin.sourceforge.net/tutorials/perspective/en.shtml"><i>Hugin's
SourceForge page</i></a>
</p>

<p>
Most of the times, Hugin white balance correction in the preview window
is enough to fix the image colors. And you just need to stitch the
image.
</p>


<figure>
<img src="./jpg/mural_final.jpg" alt="mural_final.jpg">

<figcaption><span class="figure-number">Figure 7: </span>Mural final </figcaption>
</figure>
</div>
</div>

<div id="outline-container-taking_the_other_pictures" class="outline-3">
<h3 id="taking-the-other-pictures"><a id="taking_the_other_pictures"></a><span class="section-number-3">5.5</span> Taking the other pictures</h3>
<div class="outline-text-3" id="text-taking-the-other-pictures">
<p>
Move the camera to a new position and leave some overlap between the
images. It doesn't matter how much overlap you are leaving between the
images, in general, what matters is that the images overlap in a line
that can contain small errors.
</p>
</div>
</div>

<div id="outline-container-stitching" class="outline-3">
<h3 id="stitching"><a id="stitching"></a><span class="section-number-3">5.6</span> Stitching</h3>
<div class="outline-text-3" id="text-stitching">
<p>
The images of the linear panorama should be added one at a time,
therefore, you should start with a image that would be in the middle and
then move to the corners. Since this is a tutorial I will stitch only 2
images.
</p>


<figure>
<img src="./jpg/mural2_final.jpg" alt="mural2_final.jpg">

<figcaption><span class="figure-number">Figure 8: </span>Second Mural </figcaption>
</figure>

<p>
Load both of the images in Hugin, choosing the type of lens to be
rectilinear and choose some small value for the focal length, such as
10mm.
</p>

<p>
Set the control points between the images (you can also add lines) and
choose custom parameters for the geometric optimization. You should
probably set them by hand.
</p>


<figure>
<img src="./png/hugin_options2.png" alt="hugin_options2.png">

<figcaption><span class="figure-number">Figure 9: </span>Hugin Rectilinear </figcaption>
</figure>

<p>
All but one picture parameters should be constant, because we are always
adding one image at a time. For the picture that you are optimizing, you
should optimize X, Y and HFOV. Since the pictures are already straight,
you shouldn't need to optimize roll.
</p>

<p>
If this optimization is not enough, you can optimize for other
parameters, but it is usually not necessary.
</p>

<p>
If there are areas between the images that don't match very well in
their intersection, it is generally better to add a mas in order to use
the result from a single image.
</p>

<p>
Choose custom parameters for photometric optimization. Again, always
change only one image at a time. The parameters that you should optimize
are EV, Er and Eb. Optimizing the lens parameters usually result in poor
blending for linear panoramas.
</p>
</div>
</div>

<div id="outline-container-adding_masks" class="outline-3">
<h3 id="adding-masks"><a id="adding_masks"></a><span class="section-number-3">5.7</span> Adding masks</h3>
<div class="outline-text-3" id="text-adding-masks">
<p>
If the images don't perfectly match on top of each other, you have 2
options:
</p>

<ul class="org-ul">
<li>Try to optimize other lens parameters</li>
<li>Add masks to include certain parts of an image or remove it from
others.</li>
</ul>

<p>
Generally adding masks is faster and results in fewer problems.
</p>

<p>
You should also use masks to force Hugin to choose the image that has
the best resolution for areas where the details are important.
</p>
</div>
</div>

<div id="outline-container-stitching.1" class="outline-3">
<h3 id="stitching-1"><a id="stitching.1"></a><span class="section-number-3">5.8</span> Stitching</h3>
<div class="outline-text-3" id="text-stitching-1">
<p>
After you've added all the images it is time to stitch. If you are
stitching to JPG, you should keep the canvas size's dimensions below
2<sup>32</sup>-1.
</p>

<p>
Choose exposure fused from any arrangement, click in calculate optimal
size if you simply want the largest resolution possible, and stitch!
</p>


<p>
<img src="./jpg/mural_stitched.jpg" alt="mural_stitched.jpg">
<small>
Mural stitched using only 2 control points</small>
</p>

<p>
Congratulations! You've finished your linear panorama.
</p>
</div>
</div>

<div id="outline-container-common_problems" class="outline-3">
<h3 id="common-problems"><a id="common_problems"></a><span class="section-number-3">5.9</span> Common Problems</h3>
<div class="outline-text-3" id="text-common-problems">
<p>
The horizon might start to bend. In order to fix this, create a horizon
line accross pictures, by adding control points for the horizon line
across different images.
</p>
</div></div>
<br>
<div class="comments">
<div id="disqus_thread"></div>
<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'ivanaf'; // Required - Replace '<example>' with your forum shortname
    /* * * DON'T EDIT BELOW THIS LINE * * */
    var showComments = function() {
    var button = document.getElementById('comment-button')
        button.style.display = 'none'
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        };
    </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<button id="comment-button" onclick="showComments()">Show comments</button>
</div>
<div><div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Ivan Tadeu Ferreira Antunes Filho</p>
<p class="date">Date: 2020-07-27 Mon 20:59</p>
<p class="author">Github:  <a href="https://github.com/itf/">github.com/itf</a></p>
<p class="creator">Made with <a href="https://www.gnu.org/software/emacs/">Emacs</a> 27.0.50 (<a href="https://orgmode.org">Org</a> mode 9.1.9) and <a href="https://github.com/itf/org-export-head">Org export head</a> </p>
</div>
</body>
</html>
